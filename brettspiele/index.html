<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brettspiele Online - Spieleauswahl</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <header>
        <div class="container">
            <div class="header-content">
                <div class="logo">Brettspiele Online</div>
                <div class="user-controls">
                    <div class="user-info">
                        <span id="username-display"></span>
                        <div class="user-color" id="user-color-display"></div>
                        <button id="logout-button" class="small-button">Abmelden</button>
                    </div>
                    <form id="join-room-form" class="room-form">
                        <input type="text" id="room-code-input" placeholder="Raumcode eingeben" 
                               pattern="[0-9]{4}" maxlength="4" required>
                        <button type="submit">Beitreten</button>
                    </form>
                </div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <h2>Wähle ein Spiel</h2>
        <div class="game-list">
            <div class="game-card" data-game="vier-gewinnt">
                <div class="game-img" style="background-color: #3498db;"></div>
                <div class="game-info">
                    <h3>4 in einer Reihe</h3>
                    <p>Lass deine Spielsteine fallen und bilde eine Reihe aus vier gleichfarbigen Steinen.</p>
                    <button class="create-room-btn">Spielen</button>
                </div>
            </div>
            
            <div class="game-card" data-game="alle-ablegen">
                <div class="game-img" style="background-color: #e74c3c;"></div>
                <div class="game-info">
                    <h3>Alle Ablegen</h3>
                    <p>Werde alle deine Karten los, indem du passende Farben oder Zahlen spielst.</p>
                    <button class="create-room-btn">Spielen</button>
                </div>
            </div>
            
            <div class="game-card" data-game="yacht">
                <div class="game-img" style="background-color: #2ecc71;"></div>
                <div class="game-info">
                    <h3>Yacht</h3>
                    <p>Würfle und sammle Punkte durch verschiedene Kombinationen.</p>
                    <button class="create-room-btn">Spielen</button>
                </div>
            </div>
            
            <div class="game-card" data-game="kartendomino">
                <div class="game-img" style="background-color: #f1c40f;"></div>
                <div class="game-info">
                    <h3>Kartendomino</h3>
                    <p>Lege Karten passend an, um Punkte zu sammeln und als Erster alle Karten abzulegen.</p>
                    <button class="create-room-btn">Spielen</button>
                </div>
            </div>
        </div>
    </div>

    <script src="js/cookies.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Überprüfen, ob der Benutzer eingeloggt ist
            if (!isUserLoggedIn()) {
                window.location.href = 'login.html';
                return;
            }
            
            // Benutzerdaten anzeigen
            const username = getCookie('username');
            const userColor = getCookie('userColor');
            
            document.getElementById('username-display').textContent = username;
            document.getElementById('user-color-display').style.backgroundColor = userColor;
            
            // Abmelde-Button
            document.getElementById('logout-button').addEventListener('click', function() {
                logoutUser();
            });
            
            // Socket.io-Verbindung herstellen
            const socket = io();
            
            // Raumbeitritt-Formular
            document.getElementById('join-room-form').addEventListener('submit', function(e) {
                e.preventDefault();
                const roomCode = document.getElementById('room-code-input').value;
                
                if (roomCode.length === 4 && /^\d+$/.test(roomCode)) {
                    // Speichere das gewählte Spiel in der Session
                    sessionStorage.setItem('currentRoom', roomCode);
                    
                    // Sende Beitrittsanfrage an den Server
                    socket.emit('joinRoom', {
                        roomCode: roomCode,
                        username: username,
                        userColor: userColor
                    });
                }
            });
            
            // Raumerstellung (Spielstart)
            const createRoomButtons = document.querySelectorAll('.create-room-btn');
            createRoomButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const gameCard = this.closest('.game-card');
                    const gameType = gameCard.getAttribute('data-game');
                    
                    // Sende Raumerstellungsanfrage an den Server
                    socket.emit('createRoom', {
                        gameType: gameType,
                        username: username,
                        userColor: userColor
                    });
                });
            });
            
            // Server-Antworten verarbeiten
            
            // Bei erfolgreicher Raumerstellung
            socket.on('roomCreated', function(data) {
                // Speichere das gewählte Spiel und den Raumcode in der Session
                sessionStorage.setItem('currentGame', data.gameType);
                sessionStorage.setItem('currentRoom', data.roomCode);
                
                // Weiterleitung zum Spiel
                window.location.href = 'spiele/' + data.gameType + '/index.html';
            });
            
            // Bei erfolgreichem Raumbeitritt
            socket.on('joinSuccess', function(data) {
                // Speichere das gewählte Spiel und den Raumcode in der Session
                sessionStorage.setItem('currentGame', data.gameType);
                sessionStorage.setItem('currentRoom', data.roomCode);
                
                // Weiterleitung zum Spiel
                window.location.href = 'spiele/' + data.gameType + '/index.html';
            });
            
            // Bei fehlgeschlagenem Raumbeitritt
            socket.on('joinError', function(error) {
                alert('Fehler: ' + error);
            });
        });
    </script>
</body>
</html>